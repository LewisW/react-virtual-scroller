!function(t,e){"object"===typeof exports&&"undefined"!==typeof module?e(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],e):e(t.VirtualScroller={},t.React)}(this,function(t,e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var n="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function r(t,e){return t(e={exports:{}},e.exports),e.exports}function i(t){return function(){return t}}var o=function(){};o.thatReturns=i,o.thatReturnsFalse=i(!1),o.thatReturnsTrue=i(!0),o.thatReturnsNull=i(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(t){return t};var s=o;var u,a=function(t,e,n,r,i,o,s,u){if(!t){var a;if(void 0===e)a=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,i,o,s,u],c=0;(a=new Error(e.replace(/%s/g,function(){return l[c++]}))).name="Invariant Violation"}throw a.framesToPop=1,a}},l="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",c=(r(function(t){t.exports=function(){function t(t,e,n,r,i,o){o!==l&&a(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e};return n.checkPropTypes=s,n.PropTypes=n,n}()}),r(function(t,e){function n(t,e){return t===e}function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,r=null,i=null;return function(){return function(t,e,n){if(null===e||null===n||e.length!==n.length)return!1;for(var r=e.length,i=0;i<r;i++)if(!t(e[i],n[i]))return!1;return!0}(e,r,arguments)||(i=t.apply(null,arguments)),r=arguments,i}}function i(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];var s=0,u=i.pop(),a=function(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every(function(t){return"function"===typeof t})){var n=e.map(function(t){return typeof t}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return e}(i),l=t.apply(void 0,[function(){return s++,u.apply(null,arguments)}].concat(n)),c=r(function(){for(var t=[],e=a.length,n=0;n<e;n++)t.push(a[n].apply(null,arguments));return l.apply(null,t)});return c.resultFunc=u,c.recomputations=function(){return s},c.resetRecomputations=function(){return s=0},c}}e.__esModule=!0,e.defaultMemoize=r,e.createSelectorCreator=i,e.createStructuredSelector=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;if("object"!==typeof t)throw new Error("createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof t);var n=Object.keys(t);return e(n.map(function(e){return t[e]}),function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.reduce(function(t,e,r){return t[n[r]]=e,t},{})})};var o=e.createSelector=i(r)}));(u=c)&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")&&u.default;c.defaultMemoize,c.createSelectorCreator,c.createStructuredSelector;var f=c.createSelector,h=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)};function d(t){return[t.props,t.state]}var p=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=f.apply(void 0,n);return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;return i.apply(void 0,h(d(e)).concat([e]))}},g="Expected a function",v=NaN,_="[object Symbol]",y=/^\s+|\s+$/g,m=/^[-+]0x[0-9a-f]+$/i,w=/^0b[01]+$/i,R=/^0o[0-7]+$/i,S=parseInt,b="object"==typeof n&&n&&n.Object===Object&&n,k="object"==typeof self&&self&&self.Object===Object&&self,T=b||k||Function("return this")(),O=Object.prototype.toString,I=Math.max,E=Math.min,P=function(){return T.Date.now()};function L(t,e,n){var r,i,o,s,u,a,l=0,c=!1,f=!1,h=!0;if("function"!=typeof t)throw new TypeError(g);function d(e){var n=r,o=i;return r=i=void 0,l=e,s=t.apply(o,n)}function p(t){var n=t-a;return void 0===a||n>=e||n<0||f&&t-l>=o}function v(){var t,n,r=P();if(p(r))return _(r);u=setTimeout(v,(n=e-((t=r)-a),f?E(n,o-(t-l)):n))}function _(t){return u=void 0,h&&r?d(t):(r=i=void 0,s)}function y(){var t,n=P(),o=p(n);if(r=arguments,i=this,a=n,o){if(void 0===u)return l=t=a,u=setTimeout(v,e),c?d(t):s;if(f)return u=setTimeout(v,e),d(a)}return void 0===u&&(u=setTimeout(v,e)),s}return e=B(e)||0,j(n)&&(c=!!n.leading,o=(f="maxWait"in n)?I(B(n.maxWait)||0,e):o,h="trailing"in n?!!n.trailing:h),y.cancel=function(){void 0!==u&&clearTimeout(u),l=0,r=a=i=u=void 0},y.flush=function(){return void 0===u?s:_(P())},y}function j(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function B(t){if("number"==typeof t)return t;if("symbol"==typeof(e=t)||(n=e)&&"object"==typeof n&&O.call(e)==_)return v;var e,n;if(j(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=j(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(y,"");var i=w.test(t);return i||R.test(t)?S(t.slice(2),i?2:8):m.test(t)?v:+t}var x=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new TypeError(g);return j(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),L(t,e,{leading:r,maxWait:e,trailing:i})},H=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},W=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),U=function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},V=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e},A=function(){return null};var C=function(t){function n(t){H(this,n);var e=V(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._refs={},e._handleViewRefUpdate=e._handleViewRefUpdate.bind(e),e}return U(n,t),W(n,[{key:"_handleViewRefUpdate",value:function(t){this._view=t}},{key:"_handleItemRefUpdate",value:function(t,e){e?this._refs[t]=e:delete this._refs[t]}},{key:"_renderContent",value:function(){var t=this;return this.props.list.map(function(n,r){var i=n.id,o=n.data,s=t.props.renderItem(o,r),u="function"===typeof s.ref?s.ref:A;return e.cloneElement(s,{key:i,ref:function(e){t._handleItemRefUpdate(i,e),u(e)}})})}},{key:"getWrapperNode",value:function(){return this._view}},{key:"getItemHeights",value:function(){var t=this,e=this.props,n=e.list,r=e.getHeightForDomNode;return n.reduce(function(e,n){var i=n.id,o=t._refs[i];return e[i]=r(o),e},{})}},{key:"render",value:function(){var t=this.props,n=t.blankSpaceAbove,r=t.blankSpaceBelow;return e.createElement("div",{ref:this._handleViewRefUpdate,style:{paddingTop:n,paddingBottom:r},onScroll:this.handleScroll},this._renderContent())}}]),n}(e.PureComponent);function D(t,e){for(var n=0+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);n<t.length;n++)if(e(t[n],n))return n;return-1}function M(t,e,n){return t>=e&&t<n}C.defaultProps={getHeightForDomNode:function(t){return t?t.getBoundingClientRect().height:0}};var F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.top,r=void 0===n?0:n,i=e.left,o=void 0===i?0:i,s=e.height,u=void 0===s?0:s,a=e.width,l=void 0===a?0:a;H(this,t),this._top=r,this._left=o,this._height=u,this._width=l}return W(t,[{key:"getTop",value:function(){return this._top}},{key:"getBottom",value:function(){return this._top+this._height}},{key:"getLeft",value:function(){return this._left}},{key:"getRight",value:function(){return this._left+this._width}},{key:"getHeight",value:function(){return this._height}},{key:"getWidth",value:function(){return this._width}},{key:"doesIntersectWith",value:function(t){var e=this.getTop(),n=this.getBottom(),r=this.getLeft(),i=this.getRight(),o=t.getTop(),s=t.getBottom(),u=t.getLeft(),a=t.getRight();return M(e,o,s)||M(o,e,n)||M(r,u,a)||M(u,r,i)}},{key:"contains",value:function(t){return void 0===t.x?M(t.y,this.getTop(),this.getBottom()):void 0===t.y?M(t.x,this.getLeft(),this.getRight()):M(t.y,this.getTop(),this.getBottom())&&M(t.x,this.getLeft(),this.getRight())}},{key:"translateBy",value:function(e,n){var r=this.getLeft(),i=this.getTop();return e&&(r+=e),n&&(i+=n),new t({left:r,top:i,width:this.getWidth(),height:this.getHeight()})}}]),t}(),N=function(){function t(e){var n=e.viewportRectangle,r=e.list,i=e.rectangles,o=e.sliceStart,s=e.sliceEnd;H(this,t),this._viewportRectangle=n,this._list=r,this._rectangles=i,this._sliceStart=o,this._sliceEnd=s}return W(t,[{key:"getViewportRect",value:function(){return this._viewportRectangle}},{key:"getListRect",value:function(){return this._list.length<=0?new F({top:0,height:0}):this._viewportRectangle}},{key:"getAllItems",value:function(){var t=this;return this._list.map(function(e){var n=e.id;return{id:n,rectangle:t._rectangles[n]}})}},{key:"getList",value:function(){return this._list}},{key:"getItemRect",value:function(t){return this._rectangles[t]}},{key:"findVisibleItems",value:function(){var t=this,e=this._viewportRectangle,n=this._rectangles,r=this._list,i=D(r,function(t){var r=t.id;return n[r].doesIntersectWith(e)});if(i<0)return[];var o=D(r,function(t){var r=t.id;return!n[r].doesIntersectWith(e)},i);return o<0&&(o=r.length),r.slice(i,o).filter(function(e){var n=e.id;return t.isRendered(n)}).map(function(t){var e=t.id;return{id:e,rectangle:n[e]}})}},{key:"getRenderedItems",value:function(){var t=this._rectangles;return this._list.slice(this._sliceStart,this._sliceEnd).map(function(e){var n=e.id;return{id:n,rectangle:t[n]}})}},{key:"isRendered",value:function(t){return this._getRenderedIdSet().hasOwnProperty(t)}},{key:"_getRenderedIdSet",value:function(){if(!this._renderedIdSet){this._renderedIdSet={};for(var t=this._sliceStart;t<this._sliceEnd;t++)this._renderedIdSet[this._list[t].id]=!0}return this._renderedIdSet}}]),t}(),$=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;H(this,t),this._scroller=n,this._window=e,this._programticScrollListeners=[],this._offsetTop=0,this._useWindow=this._scroller===this._window}return W(t,[{key:"_getScrollerHeight",value:function(){return this._useWindow?Math.ceil(this._window.document.documentElement.clientHeight):this._scroller.clientHeight}},{key:"_addListener",value:function(t,e,n){var r=n?this._window:this._scroller,i=function(){return e()};return r.addEventListener(t,i),function(){r.removeEventListener(t,i)}}},{key:"getRectRelativeTo",value:function(t){var e=t.getBoundingClientRect().top,n=this._useWindow?0:this._scroller.getBoundingClientRect().top;return this.getRect().translateBy(0,Math.ceil(n-e))}},{key:"setOffsetTop",value:function(t){this._offsetTop=t}},{key:"getRect",value:function(){var t=this._getScrollerHeight(),e=Math.max(0,t-this._offsetTop);return new F({top:this._offsetTop,height:e})}},{key:"scrollX",value:function(){return this._useWindow?-1*this._window.document.body.getBoundingClientRect().left:this._scroller.scrollLeft}},{key:"scrollY",value:function(){return this._useWindow?-1*this._window.document.body.getBoundingClientRect().top:this._scroller.scrollTop}},{key:"scrollBy",value:function(t){this._useWindow?this._window.scrollBy(0,t):this._scroller.scrollTop+=t,this._programticScrollListeners.forEach(function(e){return e(t)})}},{key:"addRectChangeListener",value:function(t){return this._addListener("resize",t,!0)}},{key:"addScrollListener",value:function(t){return this._addListener("scroll",t,!1)}},{key:"addProgrammaticScrollListener",value:function(t){var e=this;return this._programticScrollListeners.indexOf(t)<0&&this._programticScrollListeners.push(t),function(){return e.removeProgrammaticScrollListener(t)}}},{key:"removeProgrammaticScrollListener",value:function(t){var e=this._programticScrollListeners.indexOf(t);e>-1&&this._programticScrollListeners.splice(e,1)}}]),t}();function q(t,e){var n,r,i,o,s,u,a,l,c=(r=e,s=(n=t).getViewportRect(),u=function(t){return t&&t.doesIntersectWith(s)},a=function(t){return t?Math.abs(s.getTop()-t.getTop()):1/0},(l=r.getList().filter(function(t){var e=t.id;return n.isRendered(e)&&r.isRendered(e)})).length<=0?null:(o=function(t,e){var r,i,o,s,l,c,f,h=n.getItemRect(t.id),d=n.getItemRect(e.id);return l=d,c=(s=u)(h),f=s(l),(c&&!f?1:!c&&f?-1:0)||(i=d,o=(r=a)(h),r(i)-o)},(i=l).length<=0?null:i.reduce(function(t,e){return o(e,t)>0?e:t})));if(!c)return 0;var f=c.id,h=t.getItemRect(f).getTop()-t.getViewportRect().getTop();return e.getItemRect(f).getTop()-e.getViewportRect().getTop()-h}function z(t,e,n){var r={},i=0;return t.forEach(function(t){var o=t.id,s=void 0!==e[o]?e[o]:n;r[o]=new F({top:i,height:s}),i+=s}),r}var Y=function(t){function n(t){H(this,n);var e,r,i,o,s=V(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return s._heights={},s._getRectangles=p(s,function(t){return t.list},function(t,e,n){return n._heights},function(t){return t.assumedItemHeight},z),s._getSlice=p(s,function(t){return t.list},function(t,e){return e.sliceStart},function(t,e){return e.sliceEnd},function(t,e,n){return t.slice(e,n)}),s.state=s._getDefaultSlice(t.list),s._handleRefUpdate=s._handleRefUpdate.bind(s),s._update=s._update.bind(s),s._scheduleUpdate=(e=s._update,r=window.requestAnimationFrame,i=!1,o=function(){i=!1,e()},function(){i||r(o),i=!0}),s._handleScroll=x(s._scheduleUpdate,100,{trailing:!0}),s}return U(n,t),W(n,[{key:"_handleRefUpdate",value:function(t){this._listRef=t}},{key:"_onHeightsUpdate",value:function(t,e){this.props.viewport.scrollBy(q(t,e))}},{key:"_recordHeights",value:function(){var t=this;if(!this._listRef)return{heightDelta:0};var e=this._listRef.getItemHeights(),n=Object.keys(e).reduce(function(n,r){var i=t._heights.hasOwnProperty(r)?t._heights[r]:t.props.assumedItemHeight;return n+e[r]-i},0);return 0!==n&&(this._heights=Object.assign({},this._heights,e)),{heightDelta:n}}},{key:"_postRenderProcessing",value:function(t){var e=this._recordHeights(),n=0!==e.heightDelta;(t||n)&&this._prevPositioning&&this._onHeightsUpdate(this._prevPositioning,this.getPositioning()),(t||Math.abs(e.heightDelta)>=this.props.assumedItemHeight)&&this._scheduleUpdate()}},{key:"_getDefaultSlice",value:function(t){var e=Object.assign({},this,{props:Object.assign({},this.props,{list:t})}),n=this.props.viewport.getRect().getHeight(),r=this._getRectangles(e),i=t[0].id,o=r[i].getTop(),s=D(t,function(t){return r[t.id].getTop()-o>=n},0);return s<0&&(s=t.length),{sliceStart:0,sliceEnd:s}}},{key:"_computeBlankSpace",value:function(){var t=this.props.list,e=this.state,n=e.sliceStart,r=e.sliceEnd,i=this._getRectangles(),o=t.length-1;return{blankSpaceAbove:t.length<=0?0:i[t[n].id].getTop()-i[t[0].id].getTop(),blankSpaceBelow:r>=t.length?0:i[t[o].id].getBottom()-i[t[r].id].getTop()}}},{key:"_getRelativeViewportRect",value:function(){if(!this._listRef)return new F({top:0,height:0});var t=this._listRef.getWrapperNode();return this.props.viewport.getRectRelativeTo(t)}},{key:"_update",value:function(){var t=this.props.list;if(!this._unmounted&&0!==t.length){var e=this._getRelativeViewportRect(),n=e.getHeight()*this.props.offscreenToViewportRatio,r=e.getTop()-n,i=e.getBottom()+n,o=this._getRectangles(),s=D(t,function(t){return o[t.id].getBottom()>r});s<0&&(s=t.length-1);var u=D(t,function(t){return o[t.id].getTop()>=i},s);u<0&&(u=t.length),this._setSlice(s,u)}}},{key:"_setSlice",value:function(t,e){var n=this.state,r=n.sliceStart,i=n.sliceEnd;r===t&&i===e||this.setState({sliceStart:t,sliceEnd:e})}},{key:"getPositioning",value:function(){var t=this.state,e=t.sliceStart,n=t.sliceEnd;return new N({viewportRectangle:this._getRelativeViewportRect(),list:this.props.list,rectangles:this._getRectangles(),sliceStart:e,sliceEnd:n})}},{key:"componentDidMount",value:function(){this._unlistenScroll=this.props.viewport.addScrollListener(this._handleScroll),this._postRenderProcessing(!0)}},{key:"componentWillReceiveProps",value:function(t){var e=this.props.list,n=this.state,r=t.list;if(e!==r){var i=function(t,e,n,r){var i=e.reduce(function(t,e){return t[e.id]=!0,t},{}),o=function(t,e,n){if(e<0||e>=t.length)return-1;if(n(t[e]))return e;for(var r=1;;r++){var i=e-r,o=e+r,s=i<0,u=o>=t.length;if(s&&u)break;if(!u&&n(t[o]))return o;if(!s&&n(t[i]))return i}return-1}(t,n,function(t){return i[t.id]});if(-1===o)return null;var s=D(e,function(e){return t[o].id===e.id});return{sliceStart:s,sliceEnd:Math.min(e.length,s+r-n)}}(e,r,n.sliceStart,n.sliceEnd)||this._getDefaultSlice(r);this._setSlice(i.sliceStart,i.sliceEnd)}}},{key:"componentWillUpdate",value:function(){this._prevPositioning=this.getPositioning()}},{key:"componentDidUpdate",value:function(t){this._postRenderProcessing(t.list!==this.props.list)}},{key:"componentWillUnmount",value:function(){this._unmounted=!0,this._unlistenScroll&&this._unlistenScroll()}},{key:"render",value:function(){var t=this._computeBlankSpace(),n=t.blankSpaceAbove,r=t.blankSpaceBelow,i=this.state.sliceStart,o=this.props.renderItem;return e.createElement(C,{ref:this._handleRefUpdate,list:this._getSlice(),blankSpaceAbove:n,blankSpaceBelow:r,renderItem:function(t,e){return o(t,i+e)}})}}]),n}(e.PureComponent);Y.defaultProps={offscreenToViewportRatio:1.8,assumedItemHeight:400};var X=function(t){function n(t){H(this,n);var e=V(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e._getList=p(e,function(t){return t.items},function(t){var n={},r=[];return t.forEach(function(t){var i=e.props.identityFunction(t);n.hasOwnProperty(i)?console.warn('Duplicate item id generated in VirtualScroller. Latter item (id = "'+i+'") will be discarded'):(r.push({id:i,data:t}),n[i]=!0)}),r}),e}return U(n,t),W(n,[{key:"render",value:function(){var t=this.props,n=t.renderItem,r=t.assumedItemHeight,i=t.viewport;return e.createElement(Y,{list:this._getList(),renderItem:n,assumedItemHeight:r,viewport:i})}}]),n}(e.PureComponent);X.defaultProps={identityFunction:function(t){return t.id},offscreenToViewportRatio:1.8,assumedItemHeight:400},t.default=X,t.Viewport=$,Object.defineProperty(t,"__esModule",{value:!0})});
